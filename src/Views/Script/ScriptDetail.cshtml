@model PikaScriptDetailViewModel

@{
    ViewData["Title"] = $"Script #{Model.Script.Id}";
}
<div class="table-responsive">
    <div>
        <a href="/script/add?isTemp=true&sourceTaskId=@Model.Script.Id" class="btn btn-outline-success btn-sm"><i class="bi bi-clipboard"></i> Clone to Temp script</a>
        <span class="vr"></span>
        <a href="/script/add?sourceTaskId=@Model.Script.Id" class="btn btn-outline-info btn-sm"><i class="bi bi-clipboard-plus"></i> Clone to Saved script</a>
    </div>
    <table class="table align-middle table-borderless caption-top border border-light table-striped mt-2">
        <caption>Task Information</caption>
        <tbody>
            <tr>
                <td class="fw-bold">Id</td>
                <td>#@Model.Script.Id</td>
            </tr>
            <tr>
                <td class="fw-bold">Name</td>
                <td>@Model.Script.Name</td>
            </tr>
            <tr>
                <td class="fw-bold">Description</td>
                <td>@Model.Script.Description</td>
            </tr>
            <tr>
                <td class="fw-bold">Run Count</td>
                <td>@Model.Runs.Count</td>
            </tr>
            <tr>
                <td class="fw-bold">Shell</td>
                <td>@Html.Raw(string.Join(" &middot; ", Model.Script.ShellName, Model.Script.ShellOption, Model.Script.ShellExt))</td>
            </tr>
            <tr>
                <td class="fw-bold">Script</td>
                <td>
                    <div class="overflow-auto height-max-1 rounded">
                        <pre class="m-0 p-2" id="script">@Model.Script.Script</pre>
                    </div>
                </td>
            </tr>
            @if (!Model.Script.IsTemp)
            {
                <tr>
                    <td class="fw-bold">Actions</td>
                    <td>
                        <a class="btn btn-info btn-sm m-1 w-25" href="/script/@Model.Script.Id/update"><i class="bi bi-pen"></i> Edit</a>
                        <button type="button" class="btn btn-success btn-sm m-1 w-25" onclick="runScript(@Model.Script.Id)"><i class="bi bi-signpost"></i> Run</button>
                    </td>
                </tr>
            }

        </tbody>
    </table>
</div>

<div class="table-responsive mt-2">
    <table class="table align-middle caption-top text-md-center table-bordered table-striped">
        <caption>Latest Runs</caption>
        <thead>
            <tr>
                <th>#</th>
                <th>Start At</th>
                <th>Completed At</th>
                <th>Elapsed</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Runs)
            {
                <tr>
                    <td>#@item.Id</td>
                    <td>@Html.Raw(item.GetStartAtHtml())</td>
                    <td>@Html.Raw(item.GetCompletedAtHtml())</td>
                    <td>@Html.Raw(item.GetElapsedHtml(true))</td>
                    <td>@item.Status</td>
                    <td>
                        <a type="button" class="btn btn-primary btn-sm mx-1" href="/script/run/@item.Id"><i class="bi bi-info"></i> Detail</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script>
        hljs.highlightElement(document.querySelector("#script"));
        setActive("navScript");
    </script>
}